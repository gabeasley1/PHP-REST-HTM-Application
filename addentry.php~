<?
function GenerateXmlDoc($params) {
    $xml = "<tm><taskDescription>";
    foreach ($params as $name=>$value) {
        if ($name == "link:self") {
            $xml .= "<link href=\"$value\" rel\"self\" />";
        } else {
            $xml .= "<$name>$value</$name>";
        }
    }
    $xml .= "</taskDescription></tm>";
}

function TaskEntry($user, $name=null, $priority=null, $status=null, $eta=null, 
                  $ActivationTime=null, $ExpirationTime=null, $Addition=null, 
                  $Modification=null, $progress=null, $processProgress=null,
                  $tags=array(), $type=null, $uri=null, $method="POST")
{
    $params = array("taskPriority"=>"NONE");
    if ($name != null) $params["taskName"] = $name;
    if ($priority != null) $params["taskPriority"] = $priority;
    if ($status != null) $params["taskStatus"] = $status;
    if ($eta != null) $params["estimatedDuration"] = $eta;
    if ($ActivationTime != null) $params["taskActivationTime"]= $ActivationTime;
    if ($ExpirationTime != null) $params["taskExpirationTime"]= $ExpirationTime;
    if ($Addition != null) $params["taskAdditionTime"] = $Addition;
    if ($Modification != null) $params["taskModificationTime"] = $Modification;
    if ($progress != null) $params["taskProgress"] = $progress;
    if ($processProgress != null) $params["processProgress"] = $processProgress;
    if ($type != null) $params["taskType"] = $type;
    if ($uri != null) $params["link:self"] = $uri;
    if ($tags != null && count($tags) > 0) {
        if (count($tags) == 1) $tags = explode(",", $tags[0]);
        $tags = array_map("trim", $tags);
        $tagsHtml = implode("</taskTag><taskTag>", $tags);
        $params["taskTag"] = $tagsHtml;
    }
    $http_method = $method == "POST" ? HttpRequest::METH_POST :
        HttpRequest::METH_PUT;
    if ($uri == null && $method == "POST") {
        $uri = $user->getUri();
    }
    $request = new HttpRequest($uri, $http_method);
    $userpass = "{$user->getName()}:{$user->getPassword()}";
    $request->setOptions(array("httpauth", $userpass));
    $request->setBody(GenerateXmlDoc($params));
    //$request->setHeaders(array("Accept"=>"application/xml,text/xml;q=0.8"));
    return $request->send();
}

function AddEntry($user, $name=null, $priority=null, $status=null, $eta=null, 
                  $ActivationTime=null, $ExpirationTime=null, $Addition=null, 
                  $Modification=null, $progress=null, $processProgress=null,
                  $tags=array(), $type=null, $uri=null) {
      return TaskEntry($user, $name, $priority, $status, $eta, 
          $ActivityTime, $ExpirationTime, $Addition,
          $Modification, $progress, $processProgress,
          $tags, $type, $uri, "POST");
}

function EditEntry($user, $Name=null, $Priority=null, $Status=null, $Eta=null, 
                   $ActivationTime=null, $ExpirationTime=null, 
                   $Addition=null, $Modification=null, $Progress=null, 
                   $ProcessProgress=null, $Tags=null, $Type=null, $Uri=null)
{
      return TaskEntry($user, $name, $priority, $status, $eta, 
          $ActivityTime, $ExpirationTime, $Addition,
          $Modification, $progress, $processProgress,
          $tags, $type, $uri, "PUT");
    /*if($tags != null)
    {
       if($Tags.count() == 1)
       { 
          $Tags.trim(split("commas"));
          $request->setRawPostData($Tags);
       }
       else
       {
          $request->setRawPostData($Tags);
       } 
    }
    if($Name != null)
    {
        $request->setRawPostData($Name);
    }
    if($Type != null)
    {
        $request->setRawPostData($Type);
    }
    if($Uri != null)
    {
        $request->setRawPostData($Uri);
    }
    if($Priority != null)
    {
        $request->setRawPostData($Priority);
    }if($Status != null)
    {
        $request->setRawPostData($Status);
    }
    if($Eta != null)
    {
        $request->setRawPostData($Eta);
    }
    if($ActivationTime != null)
    {
        $request->setRawPostData($ActivationTime);
    }
    if($ExperationTime != null)
    {
        $request->setRawPostData($ExperationTime);
    }
    if($Addition != null)
    {
        $request->setRawPostData($Addition);
    }
    if($Modification != null)
    {
        $request->setRawPostData($Modification);
    }
    if($Progress != null)
    {
        $request->setRawPostData($Progress);
    }
    if($ProcessProgress != null)
    {
        $request->setRawPostData($ProcessProgress);
    }*/
}
?>
